<div x-data="games" class="px-20 py-12">
  <%= form_with model: @game do |f| %>
    <div class="md:flex md:gap-3 mt-6">
      <div class="md:w-64">
        <label class="text-sm leading-none text-gray-800" id="name">Name</label>
        <%= f.text_field :name, required: true, class: "w-full p-3 mt-3 bg-gray-100 border rounded border-gray-200 focus:outline-none focus:border-gray-600 text-sm font-medium leading-none text-gray-800", ariaLabelledby: "name", placeholder: "Enter name", tabIndex: 2 %>
      </div>
      <div style="margin-top: auto;">
        <button class="btn btn-primary">Create</button>
      </div>
    </div>
  <% end %>

  <!-- component -->
  <div class="bg-white pb-4 rounded-md w-full">
    <div class="overflow-x-auto mt-6">
      <table class="table-auto border-collapse w-full">
        <thead>
        <tr class="rounded-lg text-sm font-medium text-gray-700 text-left" style="font-size: 0.9674rem">
          <th class="px-4 py-2 bg-gray-200 " style="background-color:#f8f8f8">Name</th>
          <th class="px-4 py-2 flex mr-14 justify-end" style="background-color:#f8f8f8">Actions</th>
        </tr>
        </thead>
        <tbody class="text-sm font-normal text-gray-700">
        <% Game.all.each do |game| %>
          <tr class="hover:bg-gray-100 border-b border-t border-gray-200">
            <td class="px-4 py-4"><%= game.name %></td>
            <td class="px-4 py-4 flex gap-3 justify-end mr-10">
              <!--              <a href="#" class="text-teal-600 hover:text-teal-900 mr-5">Edit</a>-->
              <div @click="deleteGame" data-game-id="<%= game.id %>">
                Delete
                <%#= link_to 'Delete', game_path(game.id), method: :delete, class: 'text-red-600 hover:text-red-900' %>
              </div>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <style>

      thead tr th:first-child {
          border-top-left-radius: 10px;
          border-bottom-left-radius: 10px;
      }

      thead tr th:last-child {
          border-top-right-radius: 10px;
          border-bottom-right-radius: 10px;
      }

      tbody tr td:first-child {
          border-top-left-radius: 5px;
          border-bottom-left-radius: 0px;
      }

      tbody tr td:last-child {
          border-top-right-radius: 5px;
          border-bottom-right-radius: 0px;
      }


  </style>
</div>

<script type="text/javascript" charset="utf-8">
    document.addEventListener('alpine:init', () => {
        Alpine.data('games', () => ({
            deleteGame(e) {
                e.preventDefault()
                const gameId = e.target.dataset.gameId
                swal.fire({
                    title: 'Are you sure?',
                    text: 'You will not be able to recover this game!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'No, keep it'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const url = `/games/${gameId}`
                        console.log({url})
                        console.log('delete game', gameId)
                        fetch(url, {
                            method: 'DELETE',
                            headers: postHeaders
                        }).then(response => response.json()).then(data => {
                            swal.fire(
                                'Deleted!',
                                'Your game has been deleted.',
                                'success',
                            ).then(() => {
                                window.location.reload()
                            })
                        })


                    } else if (result.dismiss === swal.DismissReason.cancel) {
                        swal.fire(
                            'Cancelled',
                            'Your game is safe :)',
                            'error'
                        )
                    }
                })
            }
        }))
    })
</script>
